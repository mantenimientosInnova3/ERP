{% extends "compras/base.html" %}

{% block title %}Órdenes de Compra{% endblock %}

{% block content %}
<h2>Órdenes de Compra</h2>
<table border="1">
    <tr>
        <th>ID</th>
        <th>Proveedor</th>
        <th>Fecha</th>
        <th>Centro de Costo</th>
        <th>Detalles</th>
        <th>Acciones</th>
    </tr>
    {% for orden in ordenes %}
    <tr>
        <td>{{ orden.id }}</td>
        <td>{{ orden.proveedor }}</td>
        <td>{{ orden.fecha }}</td>
        <td>{{ orden.centro_costo }}</td>
        <td>
            {% for detalle in orden.detalleorden_set.all %}
                Producto: {{ detalle.producto }} - Cantidad: {{ detalle.cantidad }}<br>
            {% endfor %}
        </td>
        <td>
            {% if orden.id and orden.estado != "RECIBIDA" %}
                <form method="post" action="{% url 'recibir_orden' orden.id %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-sm btn-success">
                        Marcar como recibida
                    </button>
                </form>
            {% elif orden.id %}
                Recibida
            {% else %}
                —
            {% endif %}
        </td>
    </tr>
    {% empty %}
    <tr><td colspan="6">No hay órdenes registradas.</td></tr>
    {% endfor %}
</table>
{% endblock %}
